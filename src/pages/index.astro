---
import MainLayout from "../layouts/Main.astro";

import NameSection from "../components/NameSection.astro";
import TitleSection from "../components/TitleSection.astro";
import Stub from "../components/Stub.astro";

import { getVideos } from "../data/videos";
import { reads } from "../data/bookmarks";
import { getSlugs } from "../data/blogs";
import ProjectStub from "../components/ProjectStub.astro";
import BlogStub from "../components/article/BlogStub.astro";
import { formatDate } from "../utils/formatDate";

import type { MdOrMdxFile } from "../data/blogs";

const posts = await getSlugs(
	(await Astro.glob("./blog/*.md*")) as MdOrMdxFile[],
);
const videos = await getVideos();
---

<MainLayout title="Home">
  <NameSection />

  <TitleSection title="Blog" link="/blog" staggered>
    <div class="newest-blog">
      <post-container style={`--index: 0`} data-pub-date={posts[0].pubDate}>
        <BlogStub {...posts[0]} />
      </post-container>
    </div>
    {
      posts.slice(1, 5).map((post, i) => (
        <post-container style={`--index: ${i + 1}`} data-pub-date={post.pubDate}>
          <BlogStub {...post} />
        </post-container>
      ))
    }
  </TitleSection>

  <TitleSection title="Videos" link="https://www.youtube.com/emnudge">
    <div class="videos staggered">
      {
        videos.map((video, i) => (
          <a
            href={`https://www.youtube.com/watch?v=${video.id}`}
            class="video"
            style={`--index: ${i}`}
          >
            <div class="screen">
              <img alt="" src={video.img} />
              <div class="scanlines"></div>
              <div class="play-icon">â–¶</div>
            </div>
            <span class="video-date">{formatDate(video.publishedAt)}</span>
            <h3>{video.title}</h3>
          </a>
        ))
      }
    </div>
  </TitleSection>

  <TitleSection title="What I'm Reading" link="/articles" staggered>
    {
      reads.slice(0, 5).map((read, i) => (
        <post-container style={`--index: ${i}`}>
          <Stub
            url={read.link}
            meta={`${read.author} â€¢ ${formatDate(read.createdAt)}`}
            title={read.title}
          />
        </post-container>
      ))
    }
  </TitleSection>

  <TitleSection title="Check These Out">
    <div class="projects-grid staggered">
      <ProjectStub
        icon="ðŸ’¬"
        name="Unicode Lookup"
        description="Look up unicode characters in-browser and client-side"
        url="https://unicode.emnudge.dev"
      />
      <ProjectStub
        icon="â¤ï¸"
        name="My Favorite Things"
        description="A list of my favorite things because why not. (No affiliate links)"
        url="https://favorite.emnudge.dev"
      />
      <ProjectStub
        icon="ðŸ—’ï¸"
        name="What I Believe"
        description="A list of my beliefs and/or free advice."
        url="https://beliefs.emnudge.dev"
      />
      <ProjectStub
        icon="ðŸªµ"
        name="Logpipe"
        description="A better view into your development logs"
        url="https://logpipe.dev"
      />
    </div>
  </TitleSection>
</MainLayout>

<style>
  .newest-blog {
    --highlight: #a2f4ff42;
    background: linear-gradient(
      to right,
      transparent,
      var(--highlight),
      var(--highlight),
      transparent
    );
    margin: 0 -4rem;
    padding: 0 4rem;
    box-sizing: border-box;
  }
  @media screen and (max-width: 1000px) {
    .newest-blog {
      margin: 0 calc(51% - 50vw);
      padding: 0 calc(50vw - 50%);
    }
  }

  @media (prefers-color-scheme: light) {
    .newest-blog {
      --highlight: #ffdbbd
    }
  }
  :root.light .newest-blog {
    --highlight: #ffdbbd
  }
  .videos {
    display: grid;
    grid-template-columns: 1fr 1fr;
    margin: 0 auto;
  }
  @media screen and (max-width: 450px) {
    .videos {
      grid-template-columns: 1fr;
    }
  }
  .video {
    color: var(--forground);
    box-sizing: border-box;
    display: block;
    position: relative;
    width: 100%;
    padding: 24px;
  }
  .video-date {
    display: block;
    margin-top: 12px;
    font-size: 0.85rem;
    opacity: 0.5;
  }
  .video h3 {
    margin-top: 4px;
    font-weight: 300;
  }
  .video > * {
    transition: 0.25s;
  }
  .video:hover {
    background: var(--light-bg);
  }
  .video .screen {
    position: relative;
    background: #1a1a2e;
    padding: 8px;
    border-radius: 6px;
    box-shadow:
      0 0 0 3px #333,
      0 0 0 5px #1a1a1a,
      6px 8px 16px rgba(0, 0, 0, 0.4);
    overflow: hidden;
  }
  .video:nth-child(odd) .screen {
    transform: rotate(-1.5deg);
  }
  .video:nth-child(even) .screen {
    transform: rotate(1.5deg);
  }
  .video .screen::before {
    content: '';
    position: absolute;
    top: 4px;
    left: 4px;
    right: 4px;
    height: 30%;
    background: linear-gradient(180deg, rgba(255,255,255,0.08) 0%, transparent 100%);
    border-radius: 4px 4px 50% 50%;
    pointer-events: none;
    z-index: 3;
  }
  .video img {
    display: block;
    width: 100%;
    border-radius: 4px;
    filter: contrast(1.1) saturate(0.85) brightness(0.95);
  }
  .video .scanlines {
    position: absolute;
    top: 8px;
    left: 8px;
    right: 8px;
    bottom: 8px;
    background: repeating-linear-gradient(
      0deg,
      rgba(0, 0, 0, 0.12) 0px,
      rgba(0, 0, 0, 0.12) 1px,
      transparent 1px,
      transparent 3px
    );
    pointer-events: none;
    border-radius: 4px;
    z-index: 2;
  }
  .video .play-icon {
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    color: white;
    font-size: 2rem;
    text-shadow: 0 2px 12px rgba(0, 0, 0, 0.8);
    opacity: 0;
    z-index: 3;
    pointer-events: none;
    transition: opacity 0.25s;
  }
  .video:hover .play-icon {
    opacity: 0.9;
  }

  .projects-grid {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 1rem;
  }
  @media screen and (max-width: 700px) {
    .projects-grid {
      grid-template-columns: 1fr;
    }
  }
</style>
